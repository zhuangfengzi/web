<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokenæµ‹è¯•å·¥å…·</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .result { background: #f9f9f9; padding: 15px; border-radius: 4px; margin-top: 20px; }
        .error { background: #ffebee; color: #c62828; padding: 10px; border-radius: 4px; margin-top: 10px; }
        .success { background: #e8f5e8; color: #2e7d2e; padding: 10px; border-radius: 4px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ RTC Tokenæµ‹è¯•å·¥å…·</h1>
        
        <div class="form-group">
            <label>AppID:</label>
            <input type="text" id="appIdInput" placeholder="è¾“å…¥æ‚¨çš„é˜¿é‡Œäº‘RTC AppID">
        </div>
        
        <div class="form-group">
            <label>AppKey (ç”¨äºç”ŸæˆToken):</label>
            <input type="text" id="appKeyInput" placeholder="è¾“å…¥æ‚¨çš„é˜¿é‡Œäº‘RTC AppKey">
        </div>
        
        <div class="form-group">
            <label>é¢‘é“ID:</label>
            <input type="text" id="channelIdInput" placeholder="è¾“å…¥æˆ¿é—´/é¢‘é“ID">
        </div>
        
        <div class="form-group">
            <label>ç”¨æˆ·ID:</label>
            <input type="text" id="userIdInput" placeholder="è¾“å…¥ç”¨æˆ·ID">
        </div>
        
        <button onclick="generateToken()">ç”ŸæˆToken</button>
        <button onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
        
        <div id="result" class="result" style="display: none;">
            <h3>ç”Ÿæˆçš„Token:</h3>
            <textarea id="tokenOutput" rows="5" readonly></textarea>
            <br><br>
            <button onclick="copyToken()">å¤åˆ¶Token</button>
            <button onclick="openTestPage()">åœ¨æ–°é¡µé¢æµ‹è¯•</button>
        </div>
        
        <div id="message"></div>
    </div>

    <script>
        // ç®€åŒ–ç‰ˆTokenç”Ÿæˆå™¨ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
        function generateToken() {
            const appId = document.getElementById('appIdInput').value.trim();
            const appKey = document.getElementById('appKeyInput').value.trim();
            const channelId = document.getElementById('channelIdInput').value.trim();
            const userId = document.getElementById('userIdInput').value.trim();
            
            if (!appId || !appKey || !channelId || !userId) {
                showMessage('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
                return;
            }
            
            try {
                // ç”Ÿæˆç®€å•çš„æµ‹è¯•Tokenï¼ˆæ³¨æ„ï¼šè¿™ä¸æ˜¯çœŸæ­£çš„é˜¿é‡Œäº‘Tokenæ ¼å¼ï¼‰
                const timestamp = Math.floor(Date.now() / 1000);
                const expireTime = timestamp + 3600; // 1å°æ—¶åè¿‡æœŸ
                
                const tokenData = {
                    appId: appId,
                    channelId: channelId,
                    userId: userId,
                    expireTime: expireTime,
                    timestamp: timestamp,
                    // ç®€å•çš„ç­¾åï¼ˆå®é™…ç”Ÿäº§ç¯å¢ƒéœ€è¦ä½¿ç”¨æ­£ç¡®çš„ç­¾åç®—æ³•ï¼‰
                    signature: btoa(appId + channelId + userId + timestamp + appKey).substring(0, 32)
                };
                
                const token = btoa(JSON.stringify(tokenData));
                
                document.getElementById('tokenOutput').value = token;
                document.getElementById('result').style.display = 'block';
                
                showMessage('Tokenç”ŸæˆæˆåŠŸï¼ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯æµ‹è¯•Tokenï¼Œç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨æœåŠ¡ç«¯ç”Ÿæˆï¼‰', 'success');
                
            } catch (error) {
                showMessage('Tokenç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
            }
        }
        
        function copyToken() {
            const tokenOutput = document.getElementById('tokenOutput');
            tokenOutput.select();
            document.execCommand('copy');
            showMessage('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
        }
        
        function openTestPage() {
            const appId = document.getElementById('appIdInput').value.trim();
            const channelId = document.getElementById('channelIdInput').value.trim();
            const userId = document.getElementById('userIdInput').value.trim();
            const token = document.getElementById('tokenOutput').value;
            
            if (!token) {
                showMessage('è¯·å…ˆç”ŸæˆToken', 'error');
                return;
            }
            
            // æ„å»ºæµ‹è¯•URL
            const testUrl = `main.html?` +
                `resolution=1280x720&quality=hd&fps=30&` +
                `theme=${btoa(channelId.substring(0, 10) || channelId)}&` +
                `lang=${btoa(channelId.substring(10) || '_default')}&` +
                `source=${btoa(userId.substring(0, 8) || userId)}&` +
                `ref=${btoa(userId.substring(8) || '_def')}&` +
                `version=3.6.${btoa(appId).replace(/=/g, '')}&` +
                `debug=false&` +
                `timestamp=${Date.now()}&` +
                `token=${encodeURIComponent(token)}`;
            
            window.open(testUrl, '_blank');
        }
        
        function testConnection() {
            const appId = document.getElementById('appIdInput').value.trim();
            
            if (!appId) {
                showMessage('è¯·è¾“å…¥AppID', 'error');
                return;
            }
            
            showMessage('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');
            
            // æµ‹è¯•é˜¿é‡Œäº‘RTC SDKåŠ è½½
            const script = document.createElement('script');
            script.src = 'https://dingrtc.oss-cn-zhangjiakou.aliyuncs.com/sdk/web/index.umd.3.6.0.js';
            script.onload = () => {
                if (typeof DingRTC !== 'undefined') {
                    showMessage('âœ… RTC SDKåŠ è½½æˆåŠŸ', 'success');
                } else {
                    showMessage('âŒ RTC SDKåŠ è½½å¤±è´¥', 'error');
                }
            };
            script.onerror = () => {
                showMessage('âŒ æ— æ³•åŠ è½½RTC SDKï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
            };
            document.head.appendChild(script);
        }
        
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = type;
        }
        
        // é¡µé¢åŠ è½½æ—¶å¡«å…¥ç¤ºä¾‹æ•°æ®
        window.onload = () => {
            document.getElementById('channelIdInput').value = 'room' + Date.now();
            document.getElementById('userIdInput').value = 'user_' + Date.now();
        };
    </script>
</body>
</html>